<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">

    <!-- 글 등록 -->
    <insert id="insertBoard" parameterType="com.spring.app.board.domain.BoardDTO">
        INSERT INTO tbl_board (
            board_seq,
            fk_board_type_seq,
            fk_board_category_seq,
            fk_member_seq,
            board_title,
            board_content,
            board_regdate,
            board_readcount,
            board_password,
            board_file_ori_name,
            board_file_save_name,
            board_file_size
        ) VALUES (
            board_seq.NEXTVAL,
            #{fk_board_type_seq, jdbcType=NUMERIC},
            #{fk_board_category_seq, jdbcType=NUMERIC},
            #{fk_member_seq, jdbcType=NUMERIC},
            #{board_title, jdbcType=VARCHAR},
            #{board_content, jdbcType=VARCHAR},
            SYSDATE,
            0,
            #{board_password, jdbcType=VARCHAR},
            #{board_file_ori_name, jdbcType=VARCHAR},
            #{board_file_save_name, jdbcType=VARCHAR},
            #{board_file_size, jdbcType=NUMERIC}
        )
    </insert>

    <!-- 게시글 목록 -->
    <select id="selectBoardList" parameterType="map" resultType="com.spring.app.board.domain.BoardDTO">
    SELECT 
        b.board_seq,
        b.fk_board_type_seq,
        b.fk_board_category_seq,
        b.fk_member_seq,
        b.board_title,
        b.board_content,
        b.board_regdate,
        b.board_readcount,
        b.board_password,
        b.board_file_ori_name,
        b.board_file_save_name,
        b.board_file_size,
        m.member_name,
        c.board_category_name
    FROM tbl_board b
    LEFT JOIN tbl_member m ON b.fk_member_seq = m.member_seq
    LEFT JOIN tbl_board_category c ON b.fk_board_category_seq = c.board_category_seq
    WHERE 1=1
    <if test="fk_board_type_seq != null">
        AND b.fk_board_type_seq = #{fk_board_type_seq}
    </if>
    <if test="fk_board_category_seq != null and fk_board_category_seq != ''">
        AND b.fk_board_category_seq = #{fk_board_category_seq}
    </if>
    <if test="keyword != null and keyword != ''">
        <choose>
            <when test="searchType == 'board_title'">
                AND b.board_title LIKE '%' || #{keyword} || '%'
            </when>
            <when test="searchType == 'board_content'">
                AND b.board_content LIKE '%' || #{keyword} || '%'
            </when>
            <when test="searchType == 'title_content'">
                AND (b.board_title LIKE '%' || #{keyword} || '%' OR b.board_content LIKE '%' || #{keyword} || '%')
            </when>
            <when test="searchType == 'member_name'">
                AND m.member_name LIKE '%' || #{keyword} || '%'
            </when>
        </choose>
    </if>
    ORDER BY b.board_seq DESC
</select>

</mapper>

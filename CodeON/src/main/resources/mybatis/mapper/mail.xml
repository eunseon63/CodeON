<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- SqlSessionTemplate(myBatis 3.0 이전 버전)을 사용하지 않는 Mapper Interface(myBatis 3.0 이상 버전 부터 사용가능함) 예제 ==== --> 
<!--      매퍼.xml 파일이 DAO인터페이스를 구현하는 DAO클래스의 역할을 대신해준다. 
          !!!!!! namespace 는 DAO인터페이스명으로 해야 한다. !!!!!!  --> 

<mapper namespace="com.spring.app.mail.model.MailDAO">

   <!-- === 파일첨부가 없는 글쓰기 === -->
   <insert id="write" parameterType="MailDTO">
       insert into TBL_EMAIL(email_seq, send_member_email, receive_member_email, email_title, email_content, email_regdate, email_send_status, email_receive_status, email_send_important, email_receive_important, email_readstatus)
       values(emailSeq.nextval, #{sendMemberEmail}, #{receiveMemberEmail}, #{emailTitle}, #{emailContent}, sysdate, default, default, #{emailSendImportant}, default, default)
   </insert>
   
	<select id="getTotalCount" resultType="int" parameterType="string">
	    SELECT COUNT(*)
	    FROM tbl_email
	    <where>
	        <if test="searchWord != null and searchWord != ''">
	            AND LOWER(email_content) LIKE CONCAT('%', LOWER(#{searchWord}), '%')
	        </if>
	    </where>
	</select>

	<select id="mailListSearch_withPaging" parameterType="HashMap" resultType="MailDTO">
		select *
		from tbl_email
	    <where>
	        <if test="searchWord != null and searchWord != ''">
	            AND LOWER(email_content) LIKE CONCAT('%', LOWER(#{searchWord}), '%')
	        </if>
	    </where>
		OFFSET (to_number(#{currentShowPageNo})-1)*10 ROW    
		FETCH NEXT 10 ROW ONLY
	</select>

</mapper>